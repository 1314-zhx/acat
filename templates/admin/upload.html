<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>上传面试题</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background-color: #f5f7fa;
      padding: 30px;
      color: #333;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 24px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 24px;
      color: #2c3e50;
    }
    .file-input-wrapper {
      margin-bottom: 20px;
    }
    .file-input-wrapper label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }
    .file-info {
      margin-top: 10px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 4px;
      font-size: 14px;
      display: none;
    }
    .file-info.show {
      display: block;
    }
    .btn {
      width: 100%;
      padding: 12px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn:hover:not(:disabled) {
      background: #2980b9;
    }
    .btn:disabled {
      background: #bdc3c7;
      cursor: not-allowed;
    }
    .message {
      margin-top: 16px;
      padding: 12px;
      border-radius: 4px;
      text-align: center;
    }
    .message.success {
      background: #d4edda;
      color: #155724;
    }
    .message.error {
      background: #f8d7da;
      color: #721c24;
    }
    .message.loading {
      background: #d1ecf1;
      color: #0c5460;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>上传面试题文档</h1>

  <div class="file-input-wrapper">
    <label for="fileInput">选择文件（支持 PDF / Word / TXT）</label>
    <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.txt,.md" />
    <div id="fileInfo" class="file-info"></div>
  </div>

  <button id="uploadBtn" class="btn" disabled>上传文件</button>

  <div id="message" class="message" style="display:none;"></div>
</div>

<script>
  const fileInput = document.getElementById('fileInput');
  const uploadBtn = document.getElementById('uploadBtn');
  const fileInfo = document.getElementById('fileInfo');
  const messageEl = document.getElementById('message');

  let selectedFile = null;

  // 监听文件选择
  fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    selectedFile = file;

    if (file) {
      // 检查文件类型
      const allowedExts = ['.pdf', '.doc', '.docx', '.txt', '.md'];
      const ext = '.' + file.name.split('.').pop().toLowerCase();
      if (!allowedExts.includes(ext)) {
        showMessage(`不支持的文件类型：${ext}`, 'error');
        uploadBtn.disabled = true;
        selectedFile = null;
        return;
      }

      // 显示文件信息
      const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
      fileInfo.innerHTML = `
          <strong>文件名：</strong>${file.name}<br>
          <strong>大小：</strong>${sizeMB} MB
        `;
      fileInfo.classList.add('show');
      uploadBtn.disabled = false;
      hideMessage();
    } else {
      fileInfo.classList.remove('show');
      uploadBtn.disabled = true;
    }
  });

  // 上传按钮点击
  uploadBtn.addEventListener('click', () => {
    if (!selectedFile) return;

    const formData = new FormData();
    formData.append('file', selectedFile);

    showMessage('上传中...', 'loading');
    uploadBtn.disabled = true;

    // 发送 POST 请求到 /user/auth/check_reply（根据你的路由）
    // 注意：你之前是 POST /user/auth/check_reply 用于获取信件，但上传应使用单独接口
    // 假设你新增了上传接口：POST /admin/upload_question
    fetch('/admin/upload', {
      method: 'POST',
      body: formData,
      // 不要设置 Content-Type！让浏览器自动设置（含 boundary）
      credentials: 'same-origin' // 携带 cookie（用于认证）
    })
            .then(response => response.json())
            .then(data => {
              if (data.status === 200) { // 假设 code.Success = 200
                showMessage('✅ 上传成功！', 'success');
                resetForm();
              } else {
                throw new Error(data.error || data.msg || '上传失败');
              }
            })
            .catch(err => {
              console.error('Upload error:', err);
              showMessage('❌ ' + err.message, 'error');
              uploadBtn.disabled = false;
            });
  });

  function showMessage(text, type) {
    messageEl.textContent = text;
    messageEl.className = 'message ' + type;
    messageEl.style.display = 'block';
  }

  function hideMessage() {
    messageEl.style.display = 'none';
  }

  function resetForm() {
    fileInput.value = '';
    fileInfo.classList.remove('show');
    uploadBtn.disabled = true;
    selectedFile = null;
  }
</script>
</body>
</html>